# 1 线程池

由于线程的创建和销毁需要开销，频繁创建和销毁线程会影响服务器的性能。因此，服务器维护一个预先创建好的线程池。每当任务队列中有任务时，某个线程将其从中取出并执行。执行完成后，继续等待任务。

![](https://secure2.wostatic.cn/static/ken1dCVXWrs3K2uVx2Lex6/image.png?auth_key=1721658093-n8XzfDG757zuxhX6xZSpL8-0-55f92b8de151c73038adc541df2288af)

在这里使用一个条件变量，当任务队列为空时阻塞线程，当有任务插入队列时，通知线程执行任务。

# 2 数据库连接池

和线程池类似，数据库的连接池由一个队列来维护与数据库的多个连接。初始化时，创建`n`个数据库连接并将其插入到队列中。在需要访问数据库时，从队列中取出一个连接进行数据库读写操作。在读写完数据后重新将连接插入到队列中。

## 2.1 RAII

RAII（Resource Acquisition Is Initialization，资源获取即初始化）是一种C++编程惯用法，用于管理资源（如内存、文件句柄、网络连接等），确保它们在对象的生命周期内得到正确的管理和释放。

- **资源绑定到对象的生命周期：**资源在对象创建时被获取，并在对象销毁时被释放。构造函数负责获取资源，析构函数负责释放资源。
- **自动管理**：通过栈上对象的自动创建和销毁，避免手动管理资源的复杂性和潜在错误（如资源泄漏）。

数据库连接的管理采用RAII机制，可以简化资源管理。