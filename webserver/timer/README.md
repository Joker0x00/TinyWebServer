# 定时器

客户端和服务器建立TCP连接后，客户端可能会不再发送数据，此时需要断开连接释放资源。在服务器初始化时指定超时时间，当客户端和服务器之间未发生通信的时间超过超时时间后，便关闭二者的连接。

定时器的数据结构基于小跟堆实现，堆顶是距离过期最近的连接。当客户端连接服务器后，向定时器内插入超时关闭连接事件。每当服务器收到来自客户端的请求时，更新定时器内的超时时间。当某个连接超时时，将其从堆顶取出，执行关闭连接回调函数。

## 1 调整堆中元素操作

定时器的堆基于vector动态扩容数组实现。以下定义了两个调整堆中元素的操作：

- 向上调整：将某个结点不断地与其父结点比较交换，直到不能交换为止
- 向下调整：将某个结点不断地与其子结点比较交换，直到不能交换为止

## 2 堆的操作

### 2.1 增

向堆中插入元素，可以现将新插入的元素放入vector最后位置，并执行向上调整操作。

### 2.2 删

将堆顶元素与vector最后一个元素交换位置，并将记录元素个数的变量递减，然后执行向上调整操作。

### 2.3 改

利用元素与堆中下标的映射数组，找到在堆中的位置，然后分别执行向上调整和向下调整操作。

### 2.4 查

取出堆顶元素。